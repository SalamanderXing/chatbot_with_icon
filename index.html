<!DOCTYPE html>
<html>
  <head>
    <title>Simple HTML Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body style="background-color: black; color: white">
    <h1>Welcome to My Web Page</h1>
    <p>This is a simple HTML page created as a demonstration.</p>
    <a href="https://www.example.com">Visit Example</a>
    <!--<script src="./show_chatbot.js"></script>-->
    <div>
      Lorem ipsum dolor sit amet. Ut porro sunt et neque quae et aspernatur
      officia aut deserunt corrupti. Sed similique repellendus aut sequi
      consequatur aut perferendis voluptatibus ut eaque unde. Ab deleniti omnis
      ut temporibus voluptatum eos porro voluptatem a eligendi minima rem
      laudantium consectetur eos enim odio. Et molestias quasi ut asperiores
      minima aut quasi quod ab galisum sunt non possimus voluptatem. 33 animi
      quia non libero eligendi et nihil libero ut dolor sint in explicabo
      accusamus est voluptatem voluptatem. Ut voluptatem sunt aut quibusdam
      consequuntur est doloribus necessitatibus non totam molestiae et incidunt
      odio ut maxime voluptas qui fugiat illum. Rem numquam debitis At
      dignissimos nulla aut praesentium voluptatum. Et reiciendis libero et
      necessitatibus harum 33 ratione necessitatibus. Sed distinctio esse ea
      libero porro qui dolorem mollitia. Non quasi inventore sit laborum odit
      vel eius reprehenderit qui minus repellat est alias asperiores ab mollitia
      error aut delectus quia. Est maiores laudantium qui sequi autem vel ipsam
      dolor et voluptatem tempore aut ipsa quae et fugiat vitae. Et commodi
      galisum in exercitationem eligendi ut atque dolore. Aut deserunt ipsum nam
      quibusdam facilis a quibusdam voluptates nam quia enim ut saepe
      temporibus. Aut suscipit odit est natus temporibus eos voluptatem ullam.
      Aut amet iste non tenetur architecto aut distinctio officia. Qui optio
      dolor sed atque quae et dolore repudiandae et amet neque. Et omnis fugit
      et illo voluptatem id ducimus debitis. Eos aperiam velit et explicabo
      architecto vel provident dignissimos non optio incidunt! A dicta autem aut
      eveniet pariatur id dicta assumenda At veniam officia et internos
      voluptatem ut fugiat explicabo hic voluptatibus eaque. Aut illum unde qui
      velit maiores et galisum voluptatibus 33 laudantium neque. Ut alias
      assumenda qui voluptate fuga est omnis atque nam beatae esse ut asperiores
      deleniti. Et perferendis exercitationem qui porro cumque in accusamus
      mollitia At beatae nihil ut placeat ratione id tempore nihil nam suscipit
      voluptatum? Cum esse quia ut doloribus sapiente qui voluptatibus officia
      in voluptate aperiam sed consequatur assumenda qui sapiente possimus. Eum
      dolorum odio ut ipsam minus At impedit exercitationem aut labore vero et
      facere corporis. Aut aperiam veritatis ea labore ratione qui atque error.
      Ex nulla repudiandae sit molestias omnis eos impedit debitis aut beatae
      minima qui facilis placeat sit nobis reprehenderit. Ab expedita
      consequatur est voluptatum enim quo nobis sunt. Sed optio quae qui illum
      galisum eos vitae libero At voluptatem eaque. Ut placeat possimus id
      facere nostrum ex quia facilis qui ullam voluptatem! 33 distinctio rerum
      sit deserunt velit aut reiciendis odio in quia suscipit 33 repudiandae
      temporibus aut omnis dicta. At voluptates nihil 33 voluptas veritatis qui
      distinctio voluptatem sed enim enim a fuga ipsum ut dicta velit! Qui
      voluptatum labore id asperiores quae ut reiciendis perferendis sit
      expedita dicta rem laborum sunt est recusandae laborum? Sit voluptatem
      itaque in accusamus dignissimos ut perferendis totam et fuga quos sit vero
      vero est tempore nulla. Quo culpa commodi est perspiciatis consequatur ad
      ullam voluptatum. Id autem rerum At quaerat labore nam internos officiis
      non quos obcaecati ad minus consectetur. Et autem sint et dolorem
      repudiandae eum suscipit delectus. Hic explicabo aliquid a nesciunt
      molestiae est exercitationem sapiente est vitae rerum non ratione minus
      quo voluptates placeat ut deserunt quaerat! Non omnis libero et tempore
      magni in accusantium itaque. Et galisum voluptas et ipsum temporibus est
      natus provident non tempore veniam. Qui voluptates molestiae et temporibus
      quam id sapiente temporibus sed rerum necessitatibus. Aut optio corporis
      ea deleniti dignissimos sit quae libero. Ut tempora sint eos perferendis
      temporibus et quisquam reiciendis eos laboriosam animi. Aut impedit
      facilis 33 autem quisquam cum eius praesentium ut esse fuga ut excepturi
      dolorem. Non vero unde qui obcaecati amet est quisquam culpa. Eos omnis
      consectetur non ipsum dolor qui explicabo maxime sed doloremque optio? Eos
      voluptas eligendi nam tempore internos et quam dolores. Ut quasi magni aut
      voluptatem temporibus ut officiis inventore. Ut quod rerum et delectus
      soluta ut enim aperiam qui porro delectus sit eligendi labore. Est nemo
      officiis vel explicabo voluptatum eos earum eligendi id quia laborum. Eos
      eveniet laboriosam aut enim natus 33 libero rerum. Ad esse commodi aut
      voluptatem fugiat ut galisum Quis sed quibusdam accusantium. Eos culpa
      rerum et voluptates obcaecati aut nobis natus qui neque quod ut eaque
      quae. Ea consequatur dolor ut earum Quis est accusantium esse.
    </div>
    <div>
      Lorem ipsum dolor sit amet. Ut porro sunt et neque quae et aspernatur
      officia aut deserunt corrupti. Sed similique repellendus aut sequi
      consequatur aut perferendis voluptatibus ut eaque unde. Ab deleniti omnis
      ut temporibus voluptatum eos porro voluptatem a eligendi minima rem
      laudantium consectetur eos enim odio. Et molestias quasi ut asperiores
      minima aut quasi quod ab galisum sunt non possimus voluptatem. 33 animi
      quia non libero eligendi et nihil libero ut dolor sint in explicabo
      accusamus est voluptatem voluptatem. Ut voluptatem sunt aut quibusdam
      consequuntur est doloribus necessitatibus non totam molestiae et incidunt
      odio ut maxime voluptas qui fugiat illum. Rem numquam debitis At
      dignissimos nulla aut praesentium voluptatum. Et reiciendis libero et
      necessitatibus harum 33 ratione necessitatibus. Sed distinctio esse ea
      libero porro qui dolorem mollitia. Non quasi inventore sit laborum odit
      vel eius reprehenderit qui minus repellat est alias asperiores ab mollitia
      error aut delectus quia. Est maiores laudantium qui sequi autem vel ipsam
      dolor et voluptatem tempore aut ipsa quae et fugiat vitae. Et commodi
      galisum in exercitationem eligendi ut atque dolore. Aut deserunt ipsum nam
      quibusdam facilis a quibusdam voluptates nam quia enim ut saepe
      temporibus. Aut suscipit odit est natus temporibus eos voluptatem ullam.
      Aut amet iste non tenetur architecto aut distinctio officia. Qui optio
      dolor sed atque quae et dolore repudiandae et amet neque. Et omnis fugit
      et illo voluptatem id ducimus debitis. Eos aperiam velit et explicabo
      architecto vel provident dignissimos non optio incidunt! A dicta autem aut
      eveniet pariatur id dicta assumenda At veniam officia et internos
      voluptatem ut fugiat explicabo hic voluptatibus eaque. Aut illum unde qui
      velit maiores et galisum voluptatibus 33 laudantium neque. Ut alias
      assumenda qui voluptate fuga est omnis atque nam beatae esse ut asperiores
      deleniti. Et perferendis exercitationem qui porro cumque in accusamus
      mollitia At beatae nihil ut placeat ratione id tempore nihil nam suscipit
      voluptatum? Cum esse quia ut doloribus sapiente qui voluptatibus officia
      in voluptate aperiam sed consequatur assumenda qui sapiente possimus. Eum
      dolorum odio ut ipsam minus At impedit exercitationem aut labore vero et
      facere corporis. Aut aperiam veritatis ea labore ratione qui atque error.
      Ex nulla repudiandae sit molestias omnis eos impedit debitis aut beatae
      minima qui facilis placeat sit nobis reprehenderit. Ab expedita
      consequatur est voluptatum enim quo nobis sunt. Sed optio quae qui illum
      galisum eos vitae libero At voluptatem eaque. Ut placeat possimus id
      facere nostrum ex quia facilis qui ullam voluptatem! 33 distinctio rerum
      sit deserunt velit aut reiciendis odio in quia suscipit 33 repudiandae
      temporibus aut omnis dicta. At voluptates nihil 33 voluptas veritatis qui
      distinctio voluptatem sed enim enim a fuga ipsum ut dicta velit! Qui
      voluptatum labore id asperiores quae ut reiciendis perferendis sit
      expedita dicta rem laborum sunt est recusandae laborum? Sit voluptatem
      itaque in accusamus dignissimos ut perferendis totam et fuga quos sit vero
      vero est tempore nulla. Quo culpa commodi est perspiciatis consequatur ad
      ullam voluptatum. Id autem rerum At quaerat labore nam internos officiis
      non quos obcaecati ad minus consectetur. Et autem sint et dolorem
      repudiandae eum suscipit delectus. Hic explicabo aliquid a nesciunt
      molestiae est exercitationem sapiente est vitae rerum non ratione minus
      quo voluptates placeat ut deserunt quaerat! Non omnis libero et tempore
      magni in accusantium itaque. Et galisum voluptas et ipsum temporibus est
      natus provident non tempore veniam. Qui voluptates molestiae et temporibus
      quam id sapiente temporibus sed rerum necessitatibus. Aut optio corporis
      ea deleniti dignissimos sit quae libero. Ut tempora sint eos perferendis
      temporibus et quisquam reiciendis eos laboriosam animi. Aut impedit
      facilis 33 autem quisquam cum eius praesentium ut esse fuga ut excepturi
      dolorem. Non vero unde qui obcaecati amet est quisquam culpa. Eos omnis
      consectetur non ipsum dolor qui explicabo maxime sed doloremque optio? Eos
      voluptas eligendi nam tempore internos et quam dolores. Ut quasi magni aut
      voluptatem temporibus ut officiis inventore. Ut quod rerum et delectus
      soluta ut enim aperiam qui porro delectus sit eligendi labore. Est nemo
      officiis vel explicabo voluptatum eos earum eligendi id quia laborum. Eos
      eveniet laboriosam aut enim natus 33 libero rerum. Ad esse commodi aut
      voluptatem fugiat ut galisum Quis sed quibusdam accusantium. Eos culpa
      rerum et voluptates obcaecati aut nobis natus qui neque quod ut eaque
      quae. Ea consequatur dolor ut earum Quis est accusantium esse.
    </div>
    <div id="mainContainer">
      <div id="chatbotIconContainer">
        <img
          id="chatbotIcon"
          src="https://aikosmos-r7blt2y3oa-ew.a.run.app/public/concierge-1.svg"
          alt="Chatbot"
          width="92px"
          height="92px"
        />
      </div>

      <iframe
        id="chatbotFrame"
        src="https://aikosmos-r7blt2y3oa-ew.a.run.app/"
        frameborder="0"
      ></iframe>

      <div id="animatedMessage">
        <button id="closeAnimatedMessage">&times;</button>
        Ciao, sono Nova! =) <br />
        Come posso aiutarti oggi? Cliccami, rispondo a tutto!
      </div>

      <button id="closeIframe">&times;</button>

      <style>
        #animatedMessage {
          position: fixed;
          bottom: 120px;
          right: 110px;
          border: 1px solid transparent;
          width: 240px;
          height: auto;
          border-radius: 10px 10px 0px 10px;
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
          background-color: white;
          padding: 15px 20px 15px 20px;
          font-size: 14px;
          z-index: 98;
          display: none;
          transition: transform 0.3s ease;
          letter-spacing: 0.6px;
          font-weight: 300;
        }
        #closeAnimatedMessage {
          position: absolute;
          top: 10px;
          right: 10px;
          left: auto;
          background-color: transparent;
          border: none;
          font-size: 12px;
          width: 18px;
          height: 18px;
          cursor: pointer;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          background-color: rgba(0, 0, 0, 0.08);
          padding-bottom: 4px;
        }
        #closeIframe {
          position: fixed;
          background-color: #006d66; /* #004485*/
          display: none;
          color: white;
          border: none;
          font-size: 20px;
          cursor: pointer;
          z-index: 100;
          height: 32px;
          width: 32px;
          border-radius: 50%;
          border: solid 1px white;
          padding-top: 2px;
          padding-bottom: 8px;
        }
        #chatbotIconContainer {
          /* this is the container where the icon is located */
          position: fixed;
          bottom: 40px; /* Bottom margin */
          right: 40px; /* Right margin */
          cursor: pointer;
          background-color: white;
          box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 10px;
          border-radius: 50%;
          height: 80px;
          width: 80px;
          display: flex;
          justify-content: center;
          align-items: bottom; /* vertical alignment */
          overflow: hidden;
          z-index: 98;
          padding-top: 10px;
        }
        #chatbotIcon:hover {
          transform: scale(
            1.06
          ); /* Scale up the element to 110% when hovered */
        }

        #chatbotIcon {
          transition: transform 0.2s ease !important;
          transition: opacity 0.2s ease;
        }

        iframe {
          display: none;
          border: none;
          width: 370px;
          height: 75%;
          position: fixed;
          bottom: 35px;
          right: 25px;
          border-radius: 10px;
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
          z-index: 99;
        }

        /* Full-screen style for narrow screens */
        @media (max-width: 568px) {
          iframe {
            display: absolute;
            width: 100vw;
            height: 100vh;
            border-radius: 0px;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
          }
        }
      </style>

      <script>
        const iframe = document.getElementById("chatbotFrame");
        const closeButton = document.getElementById("closeIframe");
        const animatedMessage = document.getElementById("animatedMessage");
        const stupidButton = document.getElementById("closeAnimatedMessage");
        const mobileThreshold = 710;
        const soundUrl =
          "https://proxy.notificationsounds.com/notification-sounds/confident-543/download/file-sounds-1083-confident.mp3";
        const notificationSound = new Audio(soundUrl);
        const notificationDelay = 2000;
        let hasPlayedVar = false; // This is a variable that will be used to check if the sound has played
        function centerAtTopRightFixed(sourceElement, targetElement) {
          const sourceRect = sourceElement.getBoundingClientRect();

          // Since fixed positioning is relative to the viewport, no need to add scroll values
          const topRightX = sourceRect.right;
          const topRightY = sourceRect.top;
          // Adjustments for the element's dimensions to center it at the top right corner
          const centerX = topRightX - 2.5 * 16 - targetElement.offsetWidth / 2;
          const centerY = topRightY + 2.5 * 15 - targetElement.offsetHeight / 2;

          // Set the fixed position for the target element
          targetElement.style.position = "fixed";
          targetElement.style.left = `${centerX}px`;
          targetElement.style.top = `${centerY}px`;
        }

        function adjustHeight() {
          if (window.innerWidth <= mobileThreshold) {
            const actualVisibleHeight = window.innerHeight;
            iframe.style.height = actualVisibleHeight + "px";
          }
          if (iframe.style.display === "block") {
            centerAtTopRightFixed(iframe, closeButton);
          }
        }
        const main = () => {
          window.onload = adjustHeight; // Adjust height on page load
          window.onresize = adjustHeight; // Adjust height on window resize
          document
            .getElementById("chatbotIcon")
            .addEventListener("click", function () {
              const isFullScreen = window.innerWidth <= mobileThreshold;
              const isIframeVisible = iframe.style.display === "block";
              iframe.style.display = isIframeVisible ? "none" : "block";
              closeButton.style.display = isIframeVisible ? "none" : "block";
              centerAtTopRightFixed(iframe, closeButton);
              localStorage.setItem(
                "hasPlayed",
                JSON.stringify({ hasPlayed: true })
              );
              hasPlayedVar = true;
            });

          closeButton.addEventListener("click", function () {
            iframe.style.display = "none";
            closeButton.style.display = "none";
          });
          stupidButton.onclick = () => {
            animatedMessage.style.display = "none";
          };

          ["click", "mousemove", "keypress", "touchstart", "scroll"].forEach(
            (event) => document.addEventListener(event, playSound)
          );
        };
        const animateMessage = () => {
          if (!hasPlayedVar) {
            hasPlayedVar = true;
            console.log("running");
            // Start with the div moved to the left outside of the viewport
            animatedMessage.style.transform = "translateX(-100%)";
            animatedMessage.style.display = "block";

            // Wait for the next browser repaint to ensure 'display' has taken effect
            requestAnimationFrame(() => {
              // Trigger the slide-in animation
              animatedMessage.style.transform = "translateX(0)";
            });
          }
        };
        const playSound = () => {
          // check storage in the browser to not play it twice on the same domain
          const { hasPlayed } =
            JSON.parse(localStorage.getItem("hasPlayed")) || {};
          console.log(localStorage);
          if (!hasPlayed || !hasPlayedVar) {
            let startTime = performance.now();
            const playSoundAfterDelay = () => {
              const elapsedTime = performance.now() - startTime;
              if (elapsedTime < notificationDelay) {
                animationFrameId = requestAnimationFrame(playSoundAfterDelay);
              } else {
                notificationSound.play().then(() => {
                  animateMessage();
                  // remember that you played
                  localStorage.setItem(
                    "hasPlayed",
                    JSON.stringify({ hasPlayed: true })
                  );
                });
              }
            };
            animationFrameId = requestAnimationFrame(playSoundAfterDelay);
          }
        };
        main();
      </script>
    </div>
  </body>
</html>
